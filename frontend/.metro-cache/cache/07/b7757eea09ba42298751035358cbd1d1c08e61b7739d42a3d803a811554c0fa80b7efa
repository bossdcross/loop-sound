{"dependencies":[{"name":"./surveys-utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":1,"column":146,"index":146},"end":{"line":1,"column":172,"index":172}}],"key":"dgKBy4XdCrj7/jyYaOgvep11tJw=","exportNames":["*"],"imports":1}},{"name":"../native-deps","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":1,"column":189,"index":189},"end":{"line":1,"column":214,"index":214}}],"key":"iHY+U4CZmM39rpFtIRn5FJiVDRg=","exportNames":["*"],"imports":1}},{"name":"@posthog/core","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":1,"column":225,"index":225},"end":{"line":1,"column":249,"index":249}}],"key":"QgcbFeNLovyWG+0GQoq9GjKcB80=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getActiveMatchingSurveys = getActiveMatchingSurveys;\n  var _surveysUtils = require(_dependencyMap[0], \"./surveys-utils\");\n  var _nativeDeps = require(_dependencyMap[1], \"../native-deps\");\n  var _core = require(_dependencyMap[2], \"@posthog/core\");\n  var ANY_FLAG_VARIANT = 'any';\n  function defaultMatchType(matchType) {\n    return matchType !== null && matchType !== void 0 ? matchType : _core.SurveyMatchType.Icontains;\n  }\n  function doesSurveyDeviceTypesMatch(survey) {\n    var _a;\n    if (!((_a = survey.conditions) === null || _a === void 0 ? void 0 : _a.deviceTypes) || survey.conditions.deviceTypes.length === 0) {\n      return true;\n    }\n    return _surveysUtils.surveyValidationMap[defaultMatchType(survey.conditions.deviceTypesMatchType)](survey.conditions.deviceTypes, [_nativeDeps.currentDeviceType]);\n  }\n  function isSurveyFlagEnabled(flagKey, flags) {\n    return flagKey ? !!flags[flagKey] === true : true;\n  }\n  function getActiveMatchingSurveys(surveys, flags, seenSurveys, activatedSurveys) {\n    return surveys.filter(function (survey) {\n      var _a, _b, _c, _d, _e;\n      if (!survey.start_date || survey.end_date) {\n        return false;\n      }\n      if (!doesSurveyDeviceTypesMatch(survey)) {\n        return false;\n      }\n      if (seenSurveys.includes(survey.id) && !(0, _surveysUtils.canActivateRepeatedly)(survey)) {\n        return false;\n      }\n      if (((_a = survey.conditions) === null || _a === void 0 ? void 0 : _a.url) && survey.conditions.url !== '' || ((_b = survey.conditions) === null || _b === void 0 ? void 0 : _b.selector) && survey.conditions.selector !== '') {\n        return false;\n      }\n      if (!survey.linked_flag_key && !survey.targeting_flag_key && !survey.internal_targeting_flag_key && !((_c = survey.feature_flag_keys) === null || _c === void 0 ? void 0 : _c.length)) {\n        return true;\n      }\n      var linkedFlagCheck = isSurveyFlagEnabled(survey.linked_flag_key, flags);\n      var linkedFlagVariant = (_d = survey.conditions) === null || _d === void 0 ? void 0 : _d.linkedFlagVariant;\n      var linkedFlagVariantCheck = true;\n      if (linkedFlagVariant) {\n        linkedFlagVariantCheck = survey.linked_flag_key ? flags[survey.linked_flag_key] === linkedFlagVariant || linkedFlagVariant === ANY_FLAG_VARIANT : true;\n      }\n      var targetingFlagCheck = isSurveyFlagEnabled(survey.targeting_flag_key, flags);\n      var eventBasedTargetingFlagCheck = (0, _surveysUtils.hasEvents)(survey) ? activatedSurveys.has(survey.id) : true;\n      var internalTargetingFlagCheck = survey.internal_targeting_flag_key && !(0, _surveysUtils.canActivateRepeatedly)(survey) ? isSurveyFlagEnabled(survey.internal_targeting_flag_key, flags) : true;\n      var flagsCheck = ((_e = survey.feature_flag_keys) === null || _e === void 0 ? void 0 : _e.length) ? survey.feature_flag_keys.every(function (_ref) {\n        var key = _ref.key,\n          value = _ref.value;\n        return !key || !value || isSurveyFlagEnabled(value, flags);\n      }) : true;\n      return linkedFlagCheck && linkedFlagVariantCheck && targetingFlagCheck && internalTargetingFlagCheck && eventBasedTargetingFlagCheck && flagsCheck;\n    });\n  }\n});","lineCount":60,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13,"Object"],[4,8,1,19],[4,9,1,20,"defineProperty"],[4,23,1,34],[4,24,1,35,"exports"],[4,31,1,42],[4,33,1,43],[4,45,1,55],[4,47,1,56],[5,4,1,57,"value"],[5,9,1,62],[5,11,1,63],[6,2,1,67],[6,3,1,68],[6,4,1,69],[7,2,1,70,"exports"],[7,9,1,77],[7,10,1,78,"getActiveMatchingSurveys"],[7,34,1,102],[7,37,1,103,"getActiveMatchingSurveys"],[7,61,1,127],[8,2,1,128],[8,6,1,132,"_surveysUtils"],[8,19,1,145],[8,22,1,146,"require"],[8,29,1,153],[8,30,1,153,"_dependencyMap"],[8,44,1,153],[8,66,1,171],[8,67,1,172],[9,2,1,173],[9,6,1,177,"_nativeDeps"],[9,17,1,188],[9,20,1,189,"require"],[9,27,1,196],[9,28,1,196,"_dependencyMap"],[9,42,1,196],[9,63,1,213],[9,64,1,214],[10,2,1,215],[10,6,1,219,"_core"],[10,11,1,224],[10,14,1,225,"require"],[10,21,1,232],[10,22,1,232,"_dependencyMap"],[10,36,1,232],[10,56,1,248],[10,57,1,249],[11,2,1,250],[11,6,1,254,"ANY_FLAG_VARIANT"],[11,22,1,270],[11,25,1,271],[11,30,1,276],[12,2,1,277],[12,11,1,286,"defaultMatchType"],[12,27,1,302,"defaultMatchType"],[12,28,1,303,"matchType"],[12,37,1,312],[12,39,1,313],[13,4,1,314],[13,11,1,321,"matchType"],[13,20,1,330],[13,25,1,333],[13,29,1,337],[13,33,1,339,"matchType"],[13,42,1,348],[13,47,1,351],[13,52,1,356],[13,53,1,357],[13,56,1,358,"matchType"],[13,65,1,367],[13,68,1,368,"_core"],[13,73,1,373],[13,74,1,374,"SurveyMatchType"],[13,89,1,389],[13,90,1,390,"Icontains"],[13,99,1,399],[14,2,1,400],[15,2,1,401],[15,11,1,410,"doesSurveyDeviceTypesMatch"],[15,37,1,436,"doesSurveyDeviceTypesMatch"],[15,38,1,437,"survey"],[15,44,1,443],[15,46,1,444],[16,4,1,445],[16,8,1,449,"_a"],[16,10,1,451],[17,4,1,452],[17,8,1,455],[17,10,1,457],[17,11,1,458,"_a"],[17,13,1,460],[17,16,1,461,"survey"],[17,22,1,467],[17,23,1,468,"conditions"],[17,33,1,478],[17,39,1,482],[17,43,1,486],[17,47,1,488,"_a"],[17,49,1,490],[17,54,1,493],[17,59,1,498],[17,60,1,499],[17,63,1,500],[17,68,1,505],[17,69,1,506],[17,72,1,507,"_a"],[17,74,1,509],[17,75,1,510,"deviceTypes"],[17,86,1,521],[17,87,1,522],[17,91,1,524,"survey"],[17,97,1,530],[17,98,1,531,"conditions"],[17,108,1,541],[17,109,1,542,"deviceTypes"],[17,120,1,553],[17,121,1,554,"length"],[17,127,1,560],[17,132,1,563],[17,133,1,564],[17,135,1,565],[18,6,1,566],[18,13,1,573],[18,17,1,577],[19,4,1,578],[20,4,1,579],[20,11,1,586,"_surveysUtils"],[20,24,1,599],[20,25,1,600,"surveyValidationMap"],[20,44,1,619],[20,45,1,620,"defaultMatchType"],[20,61,1,636],[20,62,1,637,"survey"],[20,68,1,643],[20,69,1,644,"conditions"],[20,79,1,654],[20,80,1,655,"deviceTypesMatchType"],[20,100,1,675],[20,101,1,676],[20,102,1,677],[20,103,1,678,"survey"],[20,109,1,684],[20,110,1,685,"conditions"],[20,120,1,695],[20,121,1,696,"deviceTypes"],[20,132,1,707],[20,134,1,708],[20,135,1,709,"_nativeDeps"],[20,146,1,720],[20,147,1,721,"currentDeviceType"],[20,164,1,738],[20,165,1,739],[20,166,1,740],[21,2,1,741],[22,2,1,742],[22,11,1,751,"isSurveyFlagEnabled"],[22,30,1,770,"isSurveyFlagEnabled"],[22,31,1,771,"flagKey"],[22,38,1,778],[22,40,1,779,"flags"],[22,45,1,784],[22,47,1,785],[23,4,1,786],[23,11,1,793,"flagKey"],[23,18,1,800],[23,21,1,801],[23,22,1,802],[23,23,1,803,"flags"],[23,28,1,808],[23,29,1,809,"flagKey"],[23,36,1,816],[23,37,1,817],[23,42,1,820],[23,46,1,824],[23,49,1,825],[23,53,1,829],[24,2,1,830],[25,2,1,831],[25,11,1,840,"getActiveMatchingSurveys"],[25,35,1,864,"getActiveMatchingSurveys"],[25,36,1,865,"surveys"],[25,43,1,872],[25,45,1,873,"flags"],[25,50,1,878],[25,52,1,879,"seenSurveys"],[25,63,1,890],[25,65,1,891,"activatedSurveys"],[25,81,1,907],[25,83,1,908],[26,4,1,909],[26,11,1,916,"surveys"],[26,18,1,923],[26,19,1,924,"filter"],[26,25,1,930],[26,26,1,931],[26,36,1,940,"survey"],[26,42,1,946],[26,44,1,947],[27,6,1,948],[27,10,1,952,"_a"],[27,12,1,954],[27,14,1,955,"_b"],[27,16,1,957],[27,18,1,958,"_c"],[27,20,1,960],[27,22,1,961,"_d"],[27,24,1,963],[27,26,1,964,"_e"],[27,28,1,966],[28,6,1,967],[28,10,1,970],[28,11,1,971,"survey"],[28,17,1,977],[28,18,1,978,"start_date"],[28,28,1,988],[28,32,1,990,"survey"],[28,38,1,996],[28,39,1,997,"end_date"],[28,47,1,1005],[28,49,1,1006],[29,8,1,1007],[29,15,1,1014],[29,20,1,1019],[30,6,1,1020],[31,6,1,1021],[31,10,1,1024],[31,11,1,1025,"doesSurveyDeviceTypesMatch"],[31,37,1,1051],[31,38,1,1052,"survey"],[31,44,1,1058],[31,45,1,1059],[31,47,1,1060],[32,8,1,1061],[32,15,1,1068],[32,20,1,1073],[33,6,1,1074],[34,6,1,1075],[34,10,1,1078,"seenSurveys"],[34,21,1,1089],[34,22,1,1090,"includes"],[34,30,1,1098],[34,31,1,1099,"survey"],[34,37,1,1105],[34,38,1,1106,"id"],[34,40,1,1108],[34,41,1,1109],[34,45,1,1111],[34,46,1,1112],[34,47,1,1113],[34,48,1,1114],[34,50,1,1115,"_surveysUtils"],[34,63,1,1128],[34,64,1,1129,"canActivateRepeatedly"],[34,85,1,1150],[34,87,1,1152,"survey"],[34,93,1,1158],[34,94,1,1159],[34,96,1,1160],[35,8,1,1161],[35,15,1,1168],[35,20,1,1173],[36,6,1,1174],[37,6,1,1175],[37,10,1,1178],[37,11,1,1179],[37,12,1,1180,"_a"],[37,14,1,1182],[37,17,1,1183,"survey"],[37,23,1,1189],[37,24,1,1190,"conditions"],[37,34,1,1200],[37,40,1,1204],[37,44,1,1208],[37,48,1,1210,"_a"],[37,50,1,1212],[37,55,1,1215],[37,60,1,1220],[37,61,1,1221],[37,64,1,1222],[37,69,1,1227],[37,70,1,1228],[37,73,1,1229,"_a"],[37,75,1,1231],[37,76,1,1232,"url"],[37,79,1,1235],[37,84,1,1238,"survey"],[37,90,1,1244],[37,91,1,1245,"conditions"],[37,101,1,1255],[37,102,1,1256,"url"],[37,105,1,1259],[37,110,1,1262],[37,112,1,1264],[37,116,1,1266],[37,117,1,1267],[37,118,1,1268,"_b"],[37,120,1,1270],[37,123,1,1271,"survey"],[37,129,1,1277],[37,130,1,1278,"conditions"],[37,140,1,1288],[37,146,1,1292],[37,150,1,1296],[37,154,1,1298,"_b"],[37,156,1,1300],[37,161,1,1303],[37,166,1,1308],[37,167,1,1309],[37,170,1,1310],[37,175,1,1315],[37,176,1,1316],[37,179,1,1317,"_b"],[37,181,1,1319],[37,182,1,1320,"selector"],[37,190,1,1328],[37,195,1,1331,"survey"],[37,201,1,1337],[37,202,1,1338,"conditions"],[37,212,1,1348],[37,213,1,1349,"selector"],[37,221,1,1357],[37,226,1,1360],[37,228,1,1362],[37,230,1,1363],[38,8,1,1364],[38,15,1,1371],[38,20,1,1376],[39,6,1,1377],[40,6,1,1378],[40,10,1,1381],[40,11,1,1382,"survey"],[40,17,1,1388],[40,18,1,1389,"linked_flag_key"],[40,33,1,1404],[40,37,1,1406],[40,38,1,1407,"survey"],[40,44,1,1413],[40,45,1,1414,"targeting_flag_key"],[40,63,1,1432],[40,67,1,1434],[40,68,1,1435,"survey"],[40,74,1,1441],[40,75,1,1442,"internal_targeting_flag_key"],[40,102,1,1469],[40,106,1,1471],[40,108,1,1473],[40,109,1,1474,"_c"],[40,111,1,1476],[40,114,1,1477,"survey"],[40,120,1,1483],[40,121,1,1484,"feature_flag_keys"],[40,138,1,1501],[40,144,1,1505],[40,148,1,1509],[40,152,1,1511,"_c"],[40,154,1,1513],[40,159,1,1516],[40,164,1,1521],[40,165,1,1522],[40,168,1,1523],[40,173,1,1528],[40,174,1,1529],[40,177,1,1530,"_c"],[40,179,1,1532],[40,180,1,1533,"length"],[40,186,1,1539],[40,187,1,1540],[40,189,1,1541],[41,8,1,1542],[41,15,1,1549],[41,19,1,1553],[42,6,1,1554],[43,6,1,1555],[43,10,1,1559,"linkedFlagCheck"],[43,25,1,1574],[43,28,1,1575,"isSurveyFlagEnabled"],[43,47,1,1594],[43,48,1,1595,"survey"],[43,54,1,1601],[43,55,1,1602,"linked_flag_key"],[43,70,1,1617],[43,72,1,1618,"flags"],[43,77,1,1623],[43,78,1,1624],[44,6,1,1625],[44,10,1,1629,"linkedFlagVariant"],[44,27,1,1646],[44,30,1,1647],[44,31,1,1648,"_d"],[44,33,1,1650],[44,36,1,1651,"survey"],[44,42,1,1657],[44,43,1,1658,"conditions"],[44,53,1,1668],[44,59,1,1672],[44,63,1,1676],[44,67,1,1678,"_d"],[44,69,1,1680],[44,74,1,1683],[44,79,1,1688],[44,80,1,1689],[44,83,1,1690],[44,88,1,1695],[44,89,1,1696],[44,92,1,1697,"_d"],[44,94,1,1699],[44,95,1,1700,"linkedFlagVariant"],[44,112,1,1717],[45,6,1,1718],[45,10,1,1722,"linkedFlagVariantCheck"],[45,32,1,1744],[45,35,1,1745],[45,39,1,1749],[46,6,1,1750],[46,10,1,1753,"linkedFlagVariant"],[46,27,1,1770],[46,29,1,1771],[47,8,1,1772,"linkedFlagVariantCheck"],[47,30,1,1794],[47,33,1,1795,"survey"],[47,39,1,1801],[47,40,1,1802,"linked_flag_key"],[47,55,1,1817],[47,58,1,1818,"flags"],[47,63,1,1823],[47,64,1,1824,"survey"],[47,70,1,1830],[47,71,1,1831,"linked_flag_key"],[47,86,1,1846],[47,87,1,1847],[47,92,1,1850,"linkedFlagVariant"],[47,109,1,1867],[47,113,1,1869,"linkedFlagVariant"],[47,130,1,1886],[47,135,1,1889,"ANY_FLAG_VARIANT"],[47,151,1,1905],[47,154,1,1906],[47,158,1,1910],[48,6,1,1911],[49,6,1,1912],[49,10,1,1916,"targetingFlagCheck"],[49,28,1,1934],[49,31,1,1935,"isSurveyFlagEnabled"],[49,50,1,1954],[49,51,1,1955,"survey"],[49,57,1,1961],[49,58,1,1962,"targeting_flag_key"],[49,76,1,1980],[49,78,1,1981,"flags"],[49,83,1,1986],[49,84,1,1987],[50,6,1,1988],[50,10,1,1992,"eventBasedTargetingFlagCheck"],[50,38,1,2020],[50,41,1,2021],[50,42,1,2022],[50,43,1,2023],[50,45,1,2024,"_surveysUtils"],[50,58,1,2037],[50,59,1,2038,"hasEvents"],[50,68,1,2047],[50,70,1,2049,"survey"],[50,76,1,2055],[50,77,1,2056],[50,80,1,2057,"activatedSurveys"],[50,96,1,2073],[50,97,1,2074,"has"],[50,100,1,2077],[50,101,1,2078,"survey"],[50,107,1,2084],[50,108,1,2085,"id"],[50,110,1,2087],[50,111,1,2088],[50,114,1,2089],[50,118,1,2093],[51,6,1,2094],[51,10,1,2098,"internalTargetingFlagCheck"],[51,36,1,2124],[51,39,1,2125,"survey"],[51,45,1,2131],[51,46,1,2132,"internal_targeting_flag_key"],[51,73,1,2159],[51,77,1,2161],[51,78,1,2162],[51,79,1,2163],[51,80,1,2164],[51,82,1,2165,"_surveysUtils"],[51,95,1,2178],[51,96,1,2179,"canActivateRepeatedly"],[51,117,1,2200],[51,119,1,2202,"survey"],[51,125,1,2208],[51,126,1,2209],[51,129,1,2210,"isSurveyFlagEnabled"],[51,148,1,2229],[51,149,1,2230,"survey"],[51,155,1,2236],[51,156,1,2237,"internal_targeting_flag_key"],[51,183,1,2264],[51,185,1,2265,"flags"],[51,190,1,2270],[51,191,1,2271],[51,194,1,2272],[51,198,1,2276],[52,6,1,2277],[52,10,1,2281,"flagsCheck"],[52,20,1,2291],[52,23,1,2292],[52,24,1,2293],[52,25,1,2294,"_e"],[52,27,1,2296],[52,30,1,2297,"survey"],[52,36,1,2303],[52,37,1,2304,"feature_flag_keys"],[52,54,1,2321],[52,60,1,2325],[52,64,1,2329],[52,68,1,2331,"_e"],[52,70,1,2333],[52,75,1,2336],[52,80,1,2341],[52,81,1,2342],[52,84,1,2343],[52,89,1,2348],[52,90,1,2349],[52,93,1,2350,"_e"],[52,95,1,2352],[52,96,1,2353,"length"],[52,102,1,2359],[52,106,1,2361,"survey"],[52,112,1,2367],[52,113,1,2368,"feature_flag_keys"],[52,130,1,2385],[52,131,1,2386,"every"],[52,136,1,2391],[52,137,1,2392],[52,147,1,2401,"_ref"],[52,151,1,2405],[52,153,1,2406],[53,8,1,2407],[53,12,1,2411,"key"],[53,15,1,2414],[53,18,1,2415,"_ref"],[53,22,1,2419],[53,23,1,2420,"key"],[53,26,1,2423],[54,10,1,2424,"value"],[54,15,1,2429],[54,18,1,2430,"_ref"],[54,22,1,2434],[54,23,1,2435,"value"],[54,28,1,2440],[55,8,1,2441],[55,15,1,2447],[55,16,1,2448,"key"],[55,19,1,2451],[55,23,1,2453],[55,24,1,2454,"value"],[55,29,1,2459],[55,33,1,2461,"isSurveyFlagEnabled"],[55,52,1,2480],[55,53,1,2481,"value"],[55,58,1,2486],[55,60,1,2487,"flags"],[55,65,1,2492],[55,66,1,2493],[56,6,1,2494],[56,7,1,2495],[56,8,1,2496],[56,11,1,2497],[56,15,1,2501],[57,6,1,2502],[57,13,1,2509,"linkedFlagCheck"],[57,28,1,2524],[57,32,1,2526,"linkedFlagVariantCheck"],[57,54,1,2548],[57,58,1,2550,"targetingFlagCheck"],[57,76,1,2568],[57,80,1,2570,"internalTargetingFlagCheck"],[57,106,1,2596],[57,110,1,2598,"eventBasedTargetingFlagCheck"],[57,138,1,2626],[57,142,1,2628,"flagsCheck"],[57,152,1,2638],[58,4,1,2639],[58,5,1,2640],[58,6,1,2641],[59,2,1,2642],[60,0,1,2643],[60,3]],"functionMap":{"names":["<global>","defaultMatchType","doesSurveyDeviceTypesMatch","isSurveyFlagEnabled","getActiveMatchingSurveys","surveys.filter$argument_0","survey.feature_flag_keys.every$argument_0"],"mappings":"AAA,qRC,4HC,qVC,yFC,oGC,q7CC,uGD,iJD"},"hasCjsExports":true},"type":"js/module"}]}